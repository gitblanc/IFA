---
title: "P2: Ejercicios de Práctica Forense I"
---
1. Abra una terminal y obtenga la fecha y la hora del sistema intervenido. Compare dicha hora con la hora oficial de España y anote cualquier diferencia

- Buscar en Google "hora oficial de España".

>[!Important]
Anotar por ejemplo: España 12:21 (CEST) UTC +2

- **Ejecutar** `date`: vie 20 sep 2024 12:38:36 CEST

2. Averiguar la versión del kernel y versión del sistema operativo.
	- **Ejecutar** `uname -a` o `cat /etc/os-release`

![](img/Pasted%20image%2020240922205826.png)

3. Obtener un listado de todos los interfaces de red presentes en el sistema y sus características.
	- **Ejecutar** `ifconfig`
	- Calculadora IP: [jodies.de](https://jodies.de/ipcalc)

![](img/Pasted%20image%2020240922205857.png)

4. Obtener el listado de todas las conexiones existentes con la máquina, tanto aquellas de entrada como las de salida. Además, deberá mostrar información de cada una de ellas, como por ejemplo los procesos que las están utilizando
	- **Ejecutar** `netstat -punta`

![](img/Pasted%20image%2020240922205925.png)

5. Averiguar qué usuarios están logueados y cuánto tiempo lleva el sistema arrancado.
	- **Ejecutar** `who; uptime`

![](img/Pasted%20image%2020240922210038.png)

6. Mostrar la información de la tabla de enrutamiento existente.
	- **Ejecutar** `route`

![](img/Pasted%20image%2020240922210108.png)

7. Mostrar los procesos que están corriendo en el sistema de todos los usuarios sin que se corte el nombre del proceso si es más largo que el ancho de la pantalla.
	- **Ejecutar** `ps -acexuww | more`

![](img/Pasted%20image%2020240922210153.png)

![](img/Pasted%20image%2020240922210238.png)

8. Visualizar cuál fue el último acceso de cada usuario al sistema y el registro de accesos de un usuario al sistema. Obtener la lista de accesos fallidos al sistema.
	- **Ejecutar** `last; last usuario; sudo lastb`

![](img/Pasted%20image%2020240922210323.png)

9. Mostrar los ficheros abiertos actualmente en el sistema.
	- **Ejecutar** `sudo lsof | more`

![](img/Pasted%20image%2020240922210359.png)

10. Mostrar información de los sistemas de ficheros que utiliza el equipo en los diferentes discos y las diferentes opciones de montaje.
	- **Ejecutar** `mount | grep /sd`

![](img/Pasted%20image%2020240922210456.png)

11. Obtener las diferentes particiones existentes en el disco duro /dev/sda, así como los sectores de inicio y fin de cada una de ellas.
	- **Ejecutar** `lsblk` o `fdisk -l`

![](img/Pasted%20image%2020240922210528.png)

>[!Important]
>Si tienes una distro Linux como tu Anfitrión, para poder introducir un USB en la máquina virtual, has de ejecutar Virtualbox como root: `sudo virtualbox`

>[!Info]
Para calcular la firma hash de un USB ejecutar: `sudo sha1sum /dev/sdb > hash_pendrive.txt`

**Montado/desmontado con Mounter**:

![](img/Pasted%20image%2020240927123034.png)

12. Averigua qué comando de Linux nos proporciona información sobre si un dispositivo ha sido reconocido por el sistema.
	- **Ejecutar** `lsusb`

![](img/Pasted%20image%2020240922213608.png)

![](img/Pasted%20image%2020240922214308.png)

>[!Info]
>Recordar el concepto **sobrecarga de protocolo**: la información enviada siempre es mayor a la real, por los envoltorios HTTP, TCP...

13. Vaya al icono del menú en la esquina inferior izquierda de la pantalla. Seleccione **Herramientas forenses** y dentro de dicha categoría Hash. Lance la aplicación **QuickHash** y una vez dentro de la misma seleccione la pestaña **Discos**. Pulse el botón que encontrará en dicha pestaña. Despliegue en la ventana que aparecerá la categoría **Discos Físicos**. Seleccione el nombre lógico del dispositivo (`/dev/sdX`) correspondiente al lápiz de memoria y seleccione como función hash **SHA1**. Calcule el hash para dicho dispositivo y almacénelo. Anote el tiempo que tarda en calcular el hash para dicho dispositivo y calcule el tiempo de hash por GB copiado.

|                    | Hash SHA1                                | Tiempo de realización | Tiempo por GB |
| ------------------ | ---------------------------------------- | --------------------- | ------------- |
| Dispositivo Físico | 153C584EA45E399B6DE6DE77B64BA778BF98CAC1 | 00:04:55              | 00:02:275     |

![](img/Pasted%20image%2020240922214623.png)

![](img/Pasted%20image%2020240922215154.png)

![](img/Pasted%20image%2020240922215457.png)

14. Obtén la firma hash del lápiz USB desde línea de comando. Realiza la firma hash utilizando el algoritmo SHA-1 y luego el algoritmo MD5. Almacena cada firma hash en un fichero distinto.
	- Para SHA1 **ejecutar**: `sudo sha1sum /dev/sdb > /home/eduardobb/IFA/P2/sha1sum.txt`

	![](img/Pasted%20image%2020240922215822.png)

	![](img/Pasted%20image%2020240922220330.png)

	- Para MD5 **ejecutar**: `sudo md5sum /dev/sdb > /home/eduardobb/IFA/P2/md5sum.txt`

	![](img/Pasted%20image%2020240922220412.png)

	![](img/Pasted%20image%2020240922220845.png)

15. Averigua cuántas particiones tiene el lápiz USB. Para ello puede utilizar la herramienta Mounter o bien el comando que utilizaste en el ejercicio 11 de esta práctica. Realiza una firma hash del fichero de dispositivo correspondiente a dicha partición, primero utilizando el hash SHA-1 y luego el MD5 y almacena cada firma hash en un fichero distinto. Finalmente, monta dicha partición en modo sólo lectura. Para montar la partición puedes utilizar bien la herramienta Mounter o bien puedes utilizar la línea de comandos.
	- Si ejecutamos `lsblk`, vemos que el usb tiene dos particiones:

![](img/Pasted%20image%2020240922220933.png)

==*¿Es lo mismo que el ej anterior?*==

16. En caso de que el pendrive contuviese una única partición, ¿coincidiría la firma hash de ésta con la firma hash del fichero de dispositivo que representa al lápiz? Razónese la respuesta y demuéstrese empíricamente.

No necesariamente, debido a que sistemas operativos tales como Windows, realizan modificaciones en ciertos registros al insertar y expulsar una unidad Flash Drive. De esta forma, al hacer ciertas escrituras justo después de insertar un USB, se generará una firma hash distinta.

17. Realiza una imagen física completa del lápiz USB. Puedes realizar la imagen con la herramienta GuyMager o desde la línea de comando. Seleccione Herramientas forenses y dentro de dicha categoría Discos. Lance la aplicación GuyMager. Seleccione el dispositivo del cual va a realizar la imagen forense (primer lápiz USB conectado a su equipo anfitrión). Una vez seleccionado pulse con el botón derecho sobre el mismo y en el menú contextual seleccione la opción Adquirir imagen. En la ventana que aparecerá a continuación seleccione la opción Linux dd raw image. Deje marcada la opción de dividir el archivo de imagen en trozos de 2GB si la unidad donde va a almacenar su imagen está formateada en FAT32. Seleccione la ruta donde va a almacenar la imagen (puede almacenar dicha imagen en la carpeta compartida por el equipo anfitrión o bien en un segundo lápiz de memoria o disco duro externo conectado a su máquina virtual). Introduzca el nombre del fichero donde va a almacenar la imagen, así como el nombre del fichero de información de la imagen. Marque la casilla correspondiente a calcular el hash SHA1 y MD5 así como la casilla de verificar la imagen después de la adquisición. Anote el tiempo que le lleva realizar la imagen. Una vez concluida la realización de la imagen compare el hash obtenido en el ejercicio 14 de esta práctica. ¿Son iguales las firmas hash?

- Primero montamos el USB:

![](img/Pasted%20image%2020240927130827.png)

- Ejecutar el comando `sudo dd if=/dev/sdb of=./imagen_usb`

![](img/Pasted%20image%2020240927131320.png)

Los md5 coinciden:

![](img/Pasted%20image%2020240927131908.png)

|                              | Hash SHA1 | Tiempo de realización |
| ---------------------------- | --------- | --------------------- |
| Dispositivo Ej 14            |           |                       |
| Imagen dispositivo (este Ej) |           |                       |

18. Realice una imagen de la partición presente en el lápiz anterior con el nombre imagen-pX.lapiz (ej.: imagen-p1.kingston) utilizando el comando adecuado, donde X es el número de partición de la que realiza la imagen.



19. Compruebe si el fichero de imagen creada en el ejercicio 18 tiene la misma firma hash que la calculada en el ejercicio 15 para la partición.



20. Montar en bucle, en modo lectura y sin permiso de ejecución la imagen de la partición del lápiz creada en el ejercicio 18.

==PARA SIGUIENTE SESION==

21. En algunas ocasiones es necesario adquirir las evidencias de un sistema utilizando un disco de arranque y una conexión de red a la cual está conectada la plataforma de recolección de evidencias. El ordenador del cual crearemos la imagen lo llamaremos ordenador “objetivo” y en el que almacenaremos la imagen lo llamaremos ordenador “recolector de evidencias”. Para poder realizar la imagen a través de la red necesitaremos en primer lugar hacer que el “recolector de evidencias” escuche el flujo de datos proveniente del ordenador “objetivo”. Esto puede hacerse mediante el comando netcat (nc).

- En Caine ejecutar: `sudo nc -l -p 666 > ./imagen_remota_usb &`
- En Ubuntu ejecutar: `sudo dd if=/dev/sdb | nc <ip-caine> 666 &`

==Tienen que ser iguales==

22. a

- Crear una imagen del dispositivo: `sudo dd if=/dev/sdb | split -d -b 100m -nombre`

23. a



24. a

